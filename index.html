<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission 2026 - V75.0 Pure HTML</title>
    <link rel="stylesheet" href="./style.css?v=75">

</head>
<body id="body">

<canvas id="canvas"></canvas>
<div class="panic-overlay" aria-hidden="true"></div>
<div id="test-indicator">!! TEST MODUS AKTIV (ENTE) !!</div>

<div id="final-screen">
    <div style="font-size: 80px; margin-bottom: 20px; font-weight: 900;">0</div>
    <h1 style="letter-spacing: 15px; font-weight: 900;">MISSION 2026</h1>
    <p style="opacity: 0.6; font-size: 14px; margin-top: 10px;">SYSTEM ABSOLUTE ZERO ACHIEVED</p>
    <button class="reboot-btn" onclick="f.reboot()">SYSTEM REBOOT</button>
    <div style="margin-top: 60px; font-size: 12px; letter-spacing: 2px;">PROJEKT VON MIKRO 26</div>
    <div style="margin-top: 6px; font-size: 10px; letter-spacing: 2px; opacity: 0.6;">FROM MIKROLABS</div>
</div>

<div class="side-btns" id="ui-btns">
    <button class="btn" onclick="f.modal('shop')" title="Shop">üíé</button>
    <button class="btn" onclick="f.modal('themes')" title="Theme Vault">üß¨</button>
    <button class="btn" onclick="f.nextTheme()" title="Design">üé®</button>
    <button class="btn" id="boost-btn" onclick="f.boost()" title="Warp Drive">üöÄ</button>
    <button class="btn" id="overdrive-btn" onclick="f.specialAction('overdrive')" title="Overdrive">
        ‚ö°<div id="od-timer-display" style="position:absolute; bottom:-18px; font-size:8px; font-weight:900; color:var(--p);"></div>
    </button>
    <button class="btn" onclick="f.os.toggle()" title="M26 OS">üñ•Ô∏è</button>
    <button class="btn" onclick="f.modal('settings')" title="Einstellungen">‚öôÔ∏è</button>
    <button class="btn" onclick="f.toggleFullscreen()" title="Vollbild">‚õ∂</button>
    <button class="btn" onclick="f.modal('commands')" title="Command Center">üõ∞Ô∏è</button>
</div>

<div class="stage" id="main-stage">
    <div class="xp-display-container" id="ui-xp" onclick="f.click(event)">
        <div id="lvl-tag" style="font-family:Orbitron; font-size:9px; background:var(--p); color:black; padding:2px 8px; border-radius:4px; font-weight:900; margin-bottom:5px; display:inline-block;">LVL 1</div>
        <div class="xp-val" id="xp-display">0 XP</div>
        <div id="xp-next" style="font-size:9px; opacity:0.6; font-family:Orbitron; margin-top:6px;">ZIEL: 500 XP</div>
    </div>

    <img src="https://image.jimcdn.com/app/cms/image/transf/none/path/s0265fddf63895aad/image/i230c837b21121d95/version/1766777777/image.png" 
         class="main-logo" id="main-logo" onclick="f.click(event)">

    <div class="countdown-grid" id="ui-timer">
        <div class="time-box"><span class="v" id="d">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">TAGE</span></div>
        <div class="time-box"><span class="v" id="h">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">STD</span></div>
        <div class="time-box"><span class="v" id="m">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">MIN</span></div>
        <div class="time-box"><span class="v" id="s">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">SEK</span></div>
    </div>

    <div class="terminal-container" id="ui-term">
        <div id="terminal-content"></div>
        <div style="padding: 6px 12px; background: #08080a; display: flex; align-items: center; border-top: 1px solid rgba(255,255,255,0.05);">
            <span style="color:var(--p); font-family:'Fira Code'; font-size:11px; margin-right:8px;">></span>
            <input type="text" id="t-input" style="background:transparent; border:none; color:white; outline:none; font-family:'Fira Code'; font-size:11px; width:100%;" placeholder="Systemzugriff..." autocomplete="off">
        </div>
    </div>

    <div class="info-panel" id="ui-info">
        <div style="margin-bottom: 5px; color: var(--p); border-bottom: 1px solid var(--p); padding-bottom: 2px;">CORRUPTION STATUS</div>
        <div class="info-grid">
            <div class="info-item" id="info-26"><span>STAGE 26 (INSTABLE)</span> <span>-1 Std</span></div>
            <div class="info-item" id="info-heavy"><span>STAGE 27 (CRITICAL)</span> <span>-60s</span></div>
            <div class="info-item" id="info-28"><span>STAGE 28 (COLLAPSE)</span> <span>-10s</span></div>
            <div class="info-item" id="info-30"><span>STAGE 30 (ZERO)</span> <span>-2.0s</span></div>
        </div>
    </div>
    
    <div style="font-size:8px; letter-spacing:4px; opacity:0.3; margin-top:8px; font-family:Orbitron;" id="sys-status">V75.0 // SYSTEM: STABLE</div>

    <div class="progress-bar-container" id="ui-progress">
        <div class="progress-fill" id="p-fill"></div>
    </div>
</div>

<div id="modal" onclick="if(event.target==this) f.modal()">
    <div class="modal-win" id="modal-content"></div>
</div>

<div id="os-shell" class="os-shell" aria-hidden="true">
    <div class="os-topbar">
        <div class="os-brand">M26 OS</div>
        <div class="os-status">
            <span id="os-status-text">SYSTEM: ONLINE</span>
            <span id="os-clock">00:00:00</span>
        </div>
        <button class="os-close" onclick="f.os.toggle()">EXIT</button>
    </div>
    <div class="os-desktop" id="os-desktop"></div>
    <div class="os-dock" id="os-dock"></div>
</div>

<script>
    // System Variablen
    let testTimeOffset = 0;
    let isTestMode = false;
    let corruptionLevel = 0;
    let primaryColor = '#00f2ff';
    let secondaryColor = '#7000ff';

    const targetDate = new Date("January 1, 2026 00:00:00").getTime();
    const startDate = new Date("January 1, 2025 00:00:00").getTime();
    
    let canvas, ctx, stars = [];
    let xp = 0, level = 1, aps = 0, mult = 1, warpActive = false;
    let odEndTime = 0, themeIdx = 0;
    const baseThemes = [
        { name: 'DEFAULT', p: '', s: '', bg: '', bg2: '', className: '' },
        { name: 'GOLD', p: '#ffcc00', s: '#ff8800', bg: '', bg2: '' },
        { name: 'PINK', p: '#ff007a', s: '#7000ff', bg: '', bg2: '' },
        { name: 'GREEN', p: '#00ff88', s: '#0088ff', bg: '', bg2: '' },
        { name: 'MATRIX', p: '#00ff41', s: '#003b00', bg: '#000500', bg2: '#000500' },
        { name: 'CYBERPUNK', p: '#fcee0a', s: '#ff003c', bg: '#020205', bg2: '#020205' },
        { name: 'RAINBOW', p: '', s: '', bg: '', bg2: '', className: 'theme-rainbow' },
        { name: 'OCEAN', p: '#5de4ff', s: '#1b5bff', bg: '#031029', bg2: '#05062a' },
        { name: 'SUNSET', p: '#ffb347', s: '#ff416c', bg: '#2b0b1c', bg2: '#12060e' },
        { name: 'AURORA', p: '#7cffe6', s: '#8d7bff', bg: '#040714', bg2: '#0b1b2d' },
        { name: 'NEBULA', p: '#ff77f0', s: '#6a00ff', bg: '#130313', bg2: '#090416' },
        { name: 'EMBER', p: '#ff6b35', s: '#ffcc00', bg: '#1b0803', bg2: '#100403' },
        { name: 'GLACIER', p: '#8ae1ff', s: '#5b6bff', bg: '#020a14', bg2: '#03061a' },
        { name: 'NOIR', p: '#d3d8ff', s: '#7a7f99', bg: '#040406', bg2: '#0a0a12' },
        { name: 'SIGNAL', p: '#24ff8f', s: '#00d1ff', bg: '#02100f', bg2: '#02141e' }
    ];
    const generatedThemes = Array.from({ length: 200 }, (_, i) => {
        const hue = Math.round((i * 360) / 200);
        const accent = (hue + 45) % 360;
        return {
            name: `SPECTRUM ${String(i + 1).padStart(3, '0')}`,
            p: `hsl(${hue} 90% 60%)`,
            s: `hsl(${accent} 90% 60%)`,
            bg: `hsl(${hue} 40% 8%)`,
            bg2: `hsl(${accent} 40% 10%)`
        };
    });
    const themeCatalog = [...baseThemes, ...generatedThemes];

    const items = [
        { id: 1, name: 'Neural Overclock', cost: 100, m: 3, a: 0, d: "Klick-Boost." },
        { id: 2, name: 'Quantum CPU', cost: 1200, m: 0, a: 80, d: "Auto-XP." },
        { id: 3, name: 'Void Harvester', cost: 15000, m: 50, a: 500, d: "Dunkle Energie." },
        { id: 4, name: 'Time Dilation', cost: 100000, m: 200, a: 2500, d: "Zeit-Streckung." },
        { id: 5, name: 'Prestige Protocol', cost: 800000, m: 1000, a: 15000, d: "System-Upgrade." },
        { id: 6, name: 'Solar Forge', cost: 2200000, m: 1800, a: 30000, d: "Sonnenkern-Booster." },
        { id: 7, name: 'Chrono Lattice', cost: 4500000, m: 2500, a: 60000, d: "Zeitgitter-Cache." },
        { id: 8, name: 'Singularity Core', cost: 9000000, m: 4000, a: 110000, d: "Schwerkraft-Matrix." },
        { id: 9, name: 'Arc Reactor', cost: 15000000, m: 6500, a: 150000, d: "Reaktor-Overdrive." },
        { id: 10, name: 'Phoenix Engine', cost: 24000000, m: 9000, a: 210000, d: "Neustart-Impulse." }
    ];

    const settingsDefaults = {
        showTerminal: true,
        showTimer: true,
        showInfoPanel: true,
        showLogo: true,
        showSidebar: true,
        showProgress: true,
        showXp: true,
        compactTerminal: false,
        denseStars: false,
        reduceMotion: false,
        glowBoost: true,
        scanlines: true,
        panicOverlay: true,
        highContrast: false,
        mutedBackground: false,
        autoWarp: false,
        autoSave: true,
        themeCycle: false,
        debugMode: false,
        bigNumbers: false
    };

    const settingsCatalog = [
        { key: 'showTerminal', label: 'Terminal anzeigen', desc: 'Terminalfenster sichtbar halten.' },
        { key: 'showTimer', label: 'Countdown anzeigen', desc: 'Timer-Grid im Zentrum.' },
        { key: 'showInfoPanel', label: 'Statuspanel anzeigen', desc: 'Corruption-Panel aktiv.' },
        { key: 'showLogo', label: 'Logo anzeigen', desc: 'Mission-Logo im Fokus.' },
        { key: 'showSidebar', label: 'Sidebar anzeigen', desc: 'Schnellbuttons rechts.' },
        { key: 'showProgress', label: 'Progressbar anzeigen', desc: 'Zeitfortschritt unten.' },
        { key: 'showXp', label: 'XP Modul anzeigen', desc: 'Level- und XP-Chip.' },
        { key: 'compactTerminal', label: 'Terminal kompakt', desc: 'Mehr Platz f√ºr Stage.' },
        { key: 'denseStars', label: 'Sternenfeld dicht', desc: 'Mehr Sterne, mehr Bewegung.' },
        { key: 'reduceMotion', label: 'Animationen reduzieren', desc: 'Sanfter Modus.' },
        { key: 'glowBoost', label: 'Glow-Boost', desc: 'St√§rkere Neon-Lichter.' },
        { key: 'scanlines', label: 'Scanlines', desc: 'Retro-Overlay aktivieren.' },
        { key: 'panicOverlay', label: 'Panic Overlay', desc: 'Rote Alarm-Layer.' },
        { key: 'highContrast', label: 'High Contrast', desc: 'Mehr Kontrast f√ºr Fokus.' },
        { key: 'mutedBackground', label: 'Muted Background', desc: 'Ged√§mpfte Hintergr√ºnde.' },
        { key: 'autoWarp', label: 'Auto-Warp', desc: 'Warp-Drive standardm√§√üig an.' },
        { key: 'autoSave', label: 'Auto-Save', desc: 'Sicherung alle 5 Sekunden.' },
        { key: 'themeCycle', label: 'Theme Cycle', desc: 'Automatisch Themes wechseln.' },
        { key: 'debugMode', label: 'Debug Mode', desc: 'Debug-Flag im HUD.' },
        { key: 'bigNumbers', label: 'Gro√üe Zahlen', desc: 'Gr√∂√üere Countdown-Ziffern.' }
    ];

    let settingsState = { ...settingsDefaults };
    let autoSaveTimer = null;
    let themeCycleTimer = null;
    let osClockTimer = null;

    const osApps = [
        { id: 'hub', name: 'System Hub', icon: 'üß≠' },
        { id: 'shop', name: 'Quantum Shop', icon: 'üíé' },
        { id: 'themes', name: 'Theme Vault', icon: 'üß¨' },
        { id: 'terminal', name: 'Terminal', icon: '‚å®Ô∏è' },
        { id: 'settings', name: 'Settings', icon: '‚öôÔ∏è' },
        { id: 'monitor', name: 'Monitor', icon: 'üì°' }
    ];

    const f = {
        save: () => {
            const data = { 
                xp, level, aps, mult, themeIdx, odEndTime, 
                counts: items.map(i => i.count || 0),
                testTimeOffset, 
                isTestMode,
                corruptionLevel,
                settingsState
            };
            localStorage.setItem('m26_v75_update', JSON.stringify(data));
        },
        load: () => {
            const s = localStorage.getItem('m26_v75_update');
            if(s) {
                const d = JSON.parse(s);
                xp = d.xp || 0; level = d.level || 1; aps = d.aps || 0; mult = d.mult || 1;
                themeIdx = Number.isInteger(d.themeIdx) ? d.themeIdx : 0; odEndTime = d.odEndTime || 0;
                if(themeIdx >= themeCatalog.length) themeIdx = 0;
                testTimeOffset = d.testTimeOffset || 0;
                isTestMode = d.isTestMode || false;
                corruptionLevel = d.corruptionLevel || 0;
                settingsState = { ...settingsDefaults, ...(d.settingsState || {}) };

                if(d.counts) d.counts.forEach((c, i) => items[i].count = c);
                f.applyTheme(themeIdx);
                f.applySettings();
                if(isTestMode) document.getElementById('test-indicator').style.display = 'block';
            }
        },
        applyTheme: (idx) => {
            const theme = themeCatalog[idx] || themeCatalog[0];
            themeCatalog.forEach((t) => { if(t.className) document.body.classList.remove(t.className); });
            if(theme.className) document.body.classList.add(theme.className);
            const setVar = (key, value) => {
                if(value) document.documentElement.style.setProperty(key, value);
                else document.documentElement.style.removeProperty(key);
            };
            setVar('--p', theme.p);
            setVar('--s', theme.s);
            setVar('--bg', theme.bg);
            setVar('--bg2', theme.bg2);
            f.syncThemeColors();
        },
        setTheme: (idx) => {
            themeIdx = ((idx % themeCatalog.length) + themeCatalog.length) % themeCatalog.length;
            f.applyTheme(themeIdx);
            f.save();
        },
        syncThemeColors: () => {
            const styles = getComputedStyle(document.body);
            primaryColor = styles.getPropertyValue('--p').trim() || primaryColor;
            secondaryColor = styles.getPropertyValue('--s').trim() || secondaryColor;
            document.documentElement.style.setProperty('--glow', `${primaryColor}55`);
        },
        buildStars: () => {
            const count = settingsState.denseStars ? 140 : 80;
            stars = [];
            for(let i=0; i<count; i++) {
                stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*1.5+0.2});
            }
        },
        applySettings: () => {
            const setVisible = (id, show) => {
                const el = document.getElementById(id);
                if(el) el.style.display = show ? '' : 'none';
            };
            setVisible('ui-term', settingsState.showTerminal);
            setVisible('ui-timer', settingsState.showTimer);
            setVisible('ui-info', settingsState.showInfoPanel);
            setVisible('main-logo', settingsState.showLogo);
            setVisible('ui-btns', settingsState.showSidebar);
            setVisible('ui-progress', settingsState.showProgress);
            setVisible('ui-xp', settingsState.showXp);

            document.body.classList.toggle('terminal-compact', settingsState.compactTerminal);
            document.body.classList.toggle('reduce-motion', settingsState.reduceMotion);
            document.body.classList.toggle('scanlines', settingsState.scanlines);
            document.body.classList.toggle('high-contrast', settingsState.highContrast);
            document.body.classList.toggle('muted-bg', settingsState.mutedBackground);
            document.body.classList.toggle('big-numbers', settingsState.bigNumbers);

            const glowStrength = settingsState.glowBoost ? '55' : '22';
            document.documentElement.style.setProperty('--glow', `${primaryColor}${glowStrength}`);

            const panicOverlay = document.querySelector('.panic-overlay');
            if(panicOverlay) panicOverlay.style.display = settingsState.panicOverlay ? '' : 'none';

            if(settingsState.autoWarp) {
                warpActive = true;
                document.getElementById('boost-btn').style.background = 'var(--p)';
            }

            if(autoSaveTimer) clearInterval(autoSaveTimer);
            autoSaveTimer = settingsState.autoSave ? setInterval(f.save, 5000) : null;

            if(themeCycleTimer) clearInterval(themeCycleTimer);
            themeCycleTimer = settingsState.themeCycle ? setInterval(() => {
                f.nextTheme();
                f.log(`THEME CYCLE: ${getThemeLabel()}`);
            }, 15000) : null;

            const indicator = document.getElementById('test-indicator');
            if(settingsState.debugMode && isTestMode) {
                indicator.innerText = "DEBUG + TEST MODE";
                indicator.style.color = 'var(--p)';
                indicator.style.display = 'block';
            } else if(settingsState.debugMode) {
                indicator.innerText = "DEBUG MODE AKTIV";
                indicator.style.color = 'var(--p)';
                indicator.style.display = 'block';
            } else {
                indicator.innerText = "!! TEST MODUS AKTIV (ENTE) !!";
                indicator.style.color = '#ff0055';
                indicator.style.display = isTestMode ? 'block' : 'none';
            }

            if(canvas) f.buildStars();
        },
        toggleSetting: (key) => {
            settingsState[key] = !settingsState[key];
            f.applySettings();
            f.save();
            f.modal('settings');
        },
        toggleFullscreen: () => {
            if(!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(() => {});
                f.log("FULLSCREEN: ON");
            } else {
                document.exitFullscreen().catch(() => {});
                f.log("FULLSCREEN: OFF");
            }
        },
        os: {
            openApps: {},
            zIndex: 20,
            toggle: (forceOpen = false) => {
                const shell = document.getElementById('os-shell');
                const isOpen = shell.classList.contains('active');
                if(isOpen && !forceOpen) {
                    shell.classList.remove('active');
                    shell.setAttribute('aria-hidden', 'true');
                    if(osClockTimer) clearInterval(osClockTimer);
                    return;
                }
                shell.classList.add('active');
                shell.setAttribute('aria-hidden', 'false');
                f.os.renderDesktop();
                f.os.renderDock();
                f.os.updateClock();
                if(osClockTimer) clearInterval(osClockTimer);
                osClockTimer = setInterval(f.os.updateClock, 1000);
            },
            updateClock: () => {
                const clock = document.getElementById('os-clock');
                if(clock) clock.innerText = new Date().toLocaleTimeString('de-DE');
            },
            renderDesktop: () => {
                const desktop = document.getElementById('os-desktop');
                desktop.innerHTML = osApps.map(app => `
                    <button class="os-icon" data-app="${app.id}">
                        <span class="os-icon-emoji">${app.icon}</span>
                        <span class="os-icon-label">${app.name}</span>
                    </button>
                `).join('');
                desktop.querySelectorAll('.os-icon').forEach(btn => {
                    btn.addEventListener('click', () => f.os.openApp(btn.dataset.app));
                });
            },
            renderDock: () => {
                const dock = document.getElementById('os-dock');
                dock.innerHTML = osApps.map(app => `
                    <button class="os-dock-btn" data-app="${app.id}" title="${app.name}">
                        ${app.icon}
                    </button>
                `).join('');
                dock.querySelectorAll('.os-dock-btn').forEach(btn => {
                    btn.addEventListener('click', () => f.os.openApp(btn.dataset.app));
                });
            },
            openApp: (appId) => {
                const shell = document.getElementById('os-shell');
                if(!shell.classList.contains('active')) f.os.toggle(true);
                if(f.os.openApps[appId]) {
                    f.os.focusApp(appId);
                    return;
                }
                const app = osApps.find(a => a.id === appId);
                if(!app) return;
                const win = document.createElement('div');
                win.className = 'os-window';
                win.dataset.app = appId;
                win.style.zIndex = `${++f.os.zIndex}`;
                win.style.left = `${120 + Math.random() * 180}px`;
                win.style.top = `${120 + Math.random() * 120}px`;
                win.innerHTML = `
                    <div class="os-window-bar">
                        <span>${app.icon} ${app.name}</span>
                        <div class="os-window-actions">
                            <button onclick="f.os.closeApp('${appId}')">‚úñ</button>
                        </div>
                    </div>
                    <div class="os-window-body">${f.os.getWindowContent(appId)}</div>
                `;
                win.addEventListener('mousedown', () => f.os.focusApp(appId));
                shell.appendChild(win);
                f.os.openApps[appId] = win;
                f.os.focusApp(appId);
            },
            closeApp: (appId) => {
                const win = f.os.openApps[appId];
                if(!win) return;
                win.remove();
                delete f.os.openApps[appId];
            },
            focusApp: (appId) => {
                const win = f.os.openApps[appId];
                if(!win) return;
                f.os.zIndex += 1;
                win.style.zIndex = `${f.os.zIndex}`;
            },
            getWindowContent: (appId) => {
                if(appId === 'hub') {
                    return `
                        <div class="os-panel">
                            <h3>Mission Control</h3>
                            <p>Core Status: ${document.getElementById('sys-status').innerText}</p>
                            <div class="os-panel-grid">
                                <button onclick="f.modal('shop')">Open Shop</button>
                                <button onclick="f.modal('themes')">Open Themes</button>
                                <button onclick="f.modal('settings')">Open Settings</button>
                                <button onclick="f.toggleFullscreen()">Toggle Fullscreen</button>
                            </div>
                        </div>
                    `;
                }
                if(appId === 'shop') {
                    return `
                        <div class="os-panel">
                            <h3>Quantum Shop Items</h3>
                            <div class="os-scroll">
                                ${items.map(item => `
                                    <div class="os-list">
                                        <div>
                                            <strong>${item.name}</strong>
                                            <div class="os-muted">${item.d}</div>
                                        </div>
                                        <span>${item.cost.toLocaleString()} XP</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                if(appId === 'themes') {
                    return `
                        <div class="os-panel">
                            <h3>Theme Vault</h3>
                            <div class="os-scroll os-grid">
                                ${themeCatalog.slice(0, 24).map((theme, idx) => `
                                    <button class="os-theme" onclick="f.setTheme(${idx}); f.log('THEME SET: ${theme.name}')">
                                        <span>${theme.name}</span>
                                        <small>#${String(idx).padStart(3,'0')}</small>
                                    </button>
                                `).join('')}
                            </div>
                            <div class="os-muted">+${themeCatalog.length - 24} weitere Themes im Vault.</div>
                        </div>
                    `;
                }
                if(appId === 'terminal') {
                    return `
                        <div class="os-panel">
                            <h3>Terminal Matrix</h3>
                            <div class="os-terminal">
                                ${terminalHelpLines.map(line => `<div>> ${line}</div>`).join('')}
                            </div>
                            <div class="os-muted">Nutze das Hauptterminal f√ºr Live-Commands.</div>
                        </div>
                    `;
                }
                if(appId === 'settings') {
                    return `
                        <div class="os-panel">
                            <h3>System Settings</h3>
                            <div class="os-scroll">
                                ${settingsCatalog.map(setting => `
                                    <div class="os-list">
                                        <div>
                                            <strong>${setting.label}</strong>
                                            <div class="os-muted">${setting.desc}</div>
                                        </div>
                                        <button class="os-toggle ${settingsState[setting.key] ? 'active' : ''}" onclick="f.toggleSetting('${setting.key}')">
                                            ${settingsState[setting.key] ? 'ON' : 'OFF'}
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                if(appId === 'monitor') {
                    return `
                        <div class="os-panel">
                            <h3>System Monitor</h3>
                            <div class="os-monitor-grid">
                                <div><span>XP</span><strong>${Math.floor(xp).toLocaleString()}</strong></div>
                                <div><span>LEVEL</span><strong>${level}</strong></div>
                                <div><span>APS</span><strong>${aps}</strong></div>
                                <div><span>MULT</span><strong>x${mult}</strong></div>
                                <div><span>THEMES</span><strong>${themeCatalog.length}</strong></div>
                                <div><span>ITEMS</span><strong>${items.length}</strong></div>
                            </div>
                            <div class="os-muted">Live stats syncen mit dem Core.</div>
                        </div>
                    `;
                }
                return '<div class="os-panel">APP NOT FOUND</div>';
            }
        },
        getXpNext: (l) => Math.floor(Math.pow(l, 2.4) * 500),
        getPrice: (i) => {
            let base = Math.floor(i.cost * Math.pow(1.6, i.count || 0));
            // Preisschwankungen bei Korruption
            if(corruptionLevel >= 1 && Math.random() < 0.1) return Math.floor(base * (Math.random() + 0.5));
            return base;
        },
        click: (e) => {
            let b = Date.now() < odEndTime ? 12 : 1;
            let g = (level * 5 + mult) * b;
            
            // Korruptionseffekte auf Gewinn
            if(corruptionLevel >= 1 && Math.random() < 0.05) g *= 0.1;
            if(corruptionLevel >= 2) g *= (Math.random() * 5);

            xp += g;
            if(e && e.clientX) {
                const el = document.createElement('div'); el.className = 'float-xp'; 
                el.innerText = `+${Math.floor(corruptionLevel >= 2 ? Math.random()*999 : g)}`; 
                el.style.left = e.clientX+'px'; el.style.top = e.clientY+'px';
                el.style.color = corruptionLevel >= 2 ? '#ff0000' : (b > 1 ? '#ffea00' : 'var(--p)');
                document.body.appendChild(el); setTimeout(() => el.remove(), 700);
            }
            f.checkLvl();
            f.save();
        },
        checkLvl: () => {
            let n = f.getXpNext(level);
            while(xp >= n) { xp -= n; level++; f.log(`LEVEL UP: ${level}`, true); n = f.getXpNext(level); }
        },
        modal: (t) => {
            if(t === 'shop' && corruptionLevel >= 1 && Math.random() < 0.2) {
                f.log("ERROR: SHOP_ACCESS_DENIED (CORE_LATENCY)");
                return;
            }
            const m = document.getElementById('modal'); const c = document.getElementById('modal-content');
            m.style.display = t ? 'flex' : 'none';
            if(t === 'shop') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:var(--p); text-align:center;">${corruptionLevel >= 2 ? 'C0RRUPT_SH0P' : 'QUANTUM SHOP'}</h2>`;
                items.forEach(i => {
                    const p = f.getPrice(i); const can = xp >= p;
                    c.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; margin:5px 0; background:rgba(255,255,255,0.03); border-radius:10px; border:1px solid ${can?'var(--p)':'#222'};">
                        <div style="font-size:10px;"><b>${corruptionLevel >= 2 ? '???' : i.name}</b> [v${i.count||0}]<br><small style="opacity:0.6">${i.d}</small></div>
                        <button onclick="if(${can}) f.buy(${i.id}, ${p})" ${can ? '' : 'disabled'} style="background:${can?'var(--p)':'#111'}; color:${can ? 'black' : '#666'}; font-family:Orbitron; font-size:9px; border:none; padding:8px 12px; border-radius:6px; cursor:${can ? 'pointer' : 'not-allowed'};">${p.toLocaleString()} XP</button>
                    </div>`;
                });
            } else if(t === 'themes') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:var(--p); text-align:center;">THEME VAULT</h2>
                <div style="font-size:9px; opacity:0.6; text-align:center;">${themeCatalog.length} THEMES // SETTHEME & THEMES COMMANDS</div>
                <div class="theme-vault">
                    ${themeCatalog.map((theme, idx) => {
                        const p = theme.p || '#00f2ff';
                        const s = theme.s || '#7000ff';
                        const bg = theme.bg || '#07070d';
                        const preview = theme.className === 'theme-rainbow'
                            ? 'linear-gradient(135deg, #ff0080, #00e5ff)'
                            : `linear-gradient(135deg, ${p}, ${s})`;
                        return `<button class="theme-card" onclick="f.setTheme(${idx}); f.modal();" title="SET ${theme.name}">
                            <div class="theme-preview" style="background:${preview}; border:1px solid ${bg};"></div>
                            ${theme.name}
                            <span>#${String(idx).padStart(3,'0')}</span>
                        </button>`;
                    }).join('')}
                </div>`;
            } else if(t === 'settings') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:var(--p); text-align:center;">SYSTEM SETTINGS</h2>
                <div style="font-size:9px; opacity:0.6; text-align:center;">${settingsCatalog.length} MODULE // TOGGLE TO CONFIGURE</div>
                <div class="settings-grid">
                    ${settingsCatalog.map(setting => `
                        <button class="setting-card ${settingsState[setting.key] ? 'active' : ''}" onclick="f.toggleSetting('${setting.key}')">
                            <div class="setting-title">${setting.label}</div>
                            <div class="setting-desc">${setting.desc}</div>
                            <span class="setting-status">${settingsState[setting.key] ? 'ON' : 'OFF'}</span>
                        </button>
                    `).join('')}
                </div>`;
            } else if(t === 'commands') {
                const commandList = Object.keys(terminalCommands).sort();
                c.innerHTML = `<h2 style="font-family:Orbitron; color:var(--p); text-align:center;">COMMAND CENTER</h2>
                <div style="font-size:9px; opacity:0.6; text-align:center;">${commandList.length} COMMANDS</div>
                <div class="command-grid">
                    ${commandList.map(cmd => `<div class="command-chip">${cmd}</div>`).join('')}
                </div>
                <div style="margin-top:12px; font-size:10px; opacity:0.6; text-align:center;">Nutze HELP oder COMMANDS im Terminal f√ºr Details.</div>`;
            } else if(t === 'test') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:#ff0055; text-align:center;">ENTE PROTOKOLL</h2>
                <input type="number" id="test-seconds-input" class="test-input-field" placeholder="Sekunden bis Ziel">
                <button class="btn" style="width:100%; margin-bottom:10px;" onclick="f.setTestTime(document.getElementById('test-seconds-input').value)">START</button>
                <button class="btn" style="width:100%;" onclick="f.modal()">CANCEL</button>`;
            }
        },
        setTestTime: (val) => {
            const seconds = parseInt(val);
            if(isNaN(seconds)) { 
                testTimeOffset = 0; 
                isTestMode = false; 
            } else { 
                testTimeOffset = targetDate - Date.now() - (seconds * 1000); 
                isTestMode = true; 
            }
            f.applySettings();
            f.modal();
            f.save();
        },
        reboot: () => {
            testTimeOffset = 0;
            isTestMode = false;
            corruptionLevel = 0;
            settingsState = { ...settingsDefaults };
            localStorage.removeItem('m26_v75_update');
            location.reload();
        },
        buy: (id, p) => {
            const i = items.find(x => x.id === id);
            if(xp >= p) { 
                xp -= p; 
                i.count = (i.count || 0) + 1; 
                aps += i.a; 
                mult += i.m; 
                f.modal('shop'); 
                f.save(); 
            }
        },
        log: (m, imp = false) => {
            const t = document.getElementById('terminal-content'); const d = document.createElement('div');
            if(corruptionLevel >= 1 && Math.random() < 0.3) m = m.replace(/[A-E]/g, '0').replace(/[S-Z]/g, '#');
            if(imp) d.style.color = 'var(--p)'; d.innerHTML = `<span>[SYS]</span> ${m}`;
            t.prepend(d); if(t.childNodes.length > 20) t.lastChild.remove();
        },
        nextTheme: () => {
            f.setTheme(themeIdx + 1);
        },
        boost: () => { warpActive = !warpActive; document.getElementById('boost-btn').style.background = warpActive ? 'var(--p)' : ''; },
        specialAction: (t) => {
            if(t === 'overdrive') {
                const cost = Math.floor(f.getXpNext(level) * 0.3);
                if(xp >= cost && Date.now() > odEndTime) { 
                    xp -= cost; 
                    odEndTime = Date.now() + 120000; 
                    f.log("OVERDRIVE AKTIVIERT"); 
                    f.save(); 
                }
            }
        }
    };

    const getCountdownDiff = () => {
        const now = Date.now();
        const realDiff = targetDate - now;
        return isTestMode ? (realDiff - testTimeOffset) : realDiff;
    };

    const formatCountdown = (diff) => {
        const safe = Math.max(0, diff);
        const d = Math.floor(safe / 86400000);
        const h = Math.floor((safe / 3600000) % 24);
        const m = Math.floor((safe / 60000) % 60);
        const s = Math.floor((safe / 1000) % 60);
        return `${String(d).padStart(2,'0')}d ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m ${String(s).padStart(2,'0')}s`;
    };

    const getThemeLabel = () => themeCatalog[themeIdx] ? themeCatalog[themeIdx].name : 'DEFAULT';

    const terminalHelpLines = [
        "CORE: HELP, COMMANDS, STATUS, VERSION, TIME, DATE, UPTIME, SYSINFO, PROTOCOL, FULLSCREEN, SETTINGS, OS",
        "STATS: XP, LEVEL, APS, MULT, CORRUPTION, PANIC, COUNTDOWN, PROGRESS, STARS, THEMECOUNT, ITEMCOUNT",
        "ACTIONS: THEME, NEXTTHEME, THEMEIDX, THEMES, SETTHEME, VAULT, WARP, BOOST, OVERDRIVE, SHOP, TEST, COMMANDS",
        "TOOLS: SAVE, LOAD, CLEAR, PING, ECHO, TRACE, SCAN, DIAG, CORE, MAP, LOGS, CALIBRATE, ALIGN, SAFEMODE, REBOOT, RESETTHEME"
    ];

    const terminalCommands = {
        HELP: { run: () => terminalHelpLines.slice().reverse().forEach(line => f.log(line)) },
        COMMANDS: { run: () => terminalCommands.HELP.run() },
        STATUS: { run: () => f.log(`STATUS: ${document.getElementById('sys-status').innerText}`) },
        VERSION: { run: () => f.log("VERSION: V75.0") },
        TIME: { run: () => f.log(`TIME: ${new Date().toLocaleTimeString('de-DE')}`) },
        DATE: { run: () => f.log(`DATE: ${new Date().toLocaleDateString('de-DE')}`) },
        UPTIME: { run: () => f.log(`UPTIME: ${Math.floor(performance.now() / 1000)}s`) },
        FULLSCREEN: { run: () => f.toggleFullscreen() },
        SETTINGS: { run: () => { f.modal('settings'); f.log("SETTINGS: OPEN"); } },
        OS: { run: () => { f.os.toggle(true); f.log("OS: OPEN"); } },
        XP: { run: () => f.log(`XP: ${Math.floor(xp).toLocaleString()} / NEXT: ${f.getXpNext(level).toLocaleString()}`) },
        LEVEL: { run: () => f.log(`LEVEL: ${level}`) },
        APS: { run: () => f.log(`APS: ${aps}`) },
        MULT: { run: () => f.log(`MULTI: x${mult}`) },
        WARP: { run: () => { f.boost(); f.log(`WARP: ${warpActive ? 'ON' : 'OFF'}`); } },
        BOOST: { run: () => terminalCommands.WARP.run() },
        OVERDRIVE: { run: () => {
            const cost = Math.floor(f.getXpNext(level) * 0.3);
            if(Date.now() <= odEndTime) { f.log("OVERDRIVE: COOLDOWN"); return; }
            if(xp < cost) { f.log(`OVERDRIVE: NEED ${cost.toLocaleString()} XP`); return; }
            f.specialAction('overdrive');
        }},
        THEME: { run: () => f.log(`THEME: ${getThemeLabel()}`) },
        NEXTTHEME: { run: () => { f.nextTheme(); f.log(`THEME SET: ${getThemeLabel()}`); } },
        THEMEIDX: { run: () => f.log(`THEME IDX: ${themeIdx}`) },
        THEMECOUNT: { run: () => f.log(`THEMECOUNT: ${themeCatalog.length}`) },
        THEMES: { run: () => f.log(`THEMES: ${themeCatalog.length} TOTAL. USE SETTHEME <IDX> OR VAULT`) },
        SETTHEME: { run: (args) => {
            const idx = parseInt(args, 10);
            if(Number.isNaN(idx)) { f.log("SETTHEME: NEED INDEX"); return; }
            if(idx < 0 || idx >= themeCatalog.length) { f.log(`SETTHEME: OUT OF RANGE (0-${themeCatalog.length - 1})`); return; }
            f.setTheme(idx);
            f.log(`THEME SET: ${getThemeLabel()}`);
        }},
        RESETTHEME: { run: () => { f.setTheme(0); f.log("THEME RESET: DEFAULT"); } },
        VAULT: { run: () => { f.modal('themes'); f.log("VAULT: OPEN"); } },
        SHOP: { run: () => { f.modal('shop'); f.log("SHOP: OPEN"); } },
        COMMANDS: { run: () => { f.modal('commands'); f.log("COMMANDS: OPEN"); } },
        ITEMCOUNT: { run: () => f.log(`ITEMCOUNT: ${items.length}`) },
        TEST: { run: () => { f.modal('test'); f.log("TEST MODE: PANEL"); } },
        REBOOT: { run: () => f.reboot() },
        SAVE: { run: () => { f.save(); f.log("SAVE: OK"); } },
        LOAD: { run: () => { f.load(); f.log("LOAD: OK"); } },
        CLEAR: { run: () => { document.getElementById('terminal-content').innerHTML = ''; f.log("TERMINAL CLEARED"); } },
        PING: { run: () => f.log("PONG") },
        ECHO: { run: (args) => f.log(args ? `ECHO: ${args}` : "ECHO: ...") },
        TRACE: { run: () => f.log("TRACE: ROUTE_STABLE") },
        SCAN: { run: () => f.log("SCAN: NO ANOMALIES") },
        DIAG: { run: () => f.log("DIAG: ALL SYSTEMS GREEN") },
        SYSINFO: { run: () => f.log("SYSINFO: QUANTUM CORE ONLINE") },
        CORE: { run: () => f.log("CORE: SYNCHRONIZED") },
        MAP: { run: () => f.log("MAP: SECTOR-07 LOCKED") },
        LOGS: { run: () => f.log("LOGS: 0 ERRORS") },
        PROTOCOL: { run: () => f.log("PROTOCOL: ORBITRON-74") },
        SAFEMODE: { run: () => f.log("SAFE MODE: DISABLED") },
        CALIBRATE: { run: () => f.log("CALIBRATE: COMPLETE") },
        ALIGN: { run: () => f.log("ALIGN: STABLE") },
        STARS: { run: () => f.log(`STARS: ${stars.length}`) },
        CORRUPTION: { run: () => f.log(`CORRUPTION: STAGE ${corruptionLevel}`) },
        PANIC: { run: () => f.log(`PANIC: ${getComputedStyle(document.documentElement).getPropertyValue('--panic').trim()}`) },
        COUNTDOWN: { run: () => f.log(`COUNTDOWN: ${formatCountdown(getCountdownDiff())}`) },
        PROGRESS: { run: () => {
            const prog = Math.min(100, ((Date.now() - startDate) / (targetDate - startDate)) * 100);
            f.log(`PROGRESS: ${prog.toFixed(2)}%`);
        }}
    };

    function init() {
        canvas = document.getElementById('canvas'); ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        f.buildStars();
        
        document.getElementById('t-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') {
                const rawInput = e.target.value.trim();
                if(!rawInput) return;
                const [first] = rawInput.split(/\s+/);
                const cmd = first.toUpperCase();
                const args = rawInput.slice(first.length).trim();
                if(corruptionLevel >= 1 && Math.random() < 0.15) { f.log(`CRITICAL: CMD_${cmd}_TIMED_OUT`); e.target.value = ''; return; }
                if(cmd === 'ENTE') f.modal('test');
                else if(terminalCommands[cmd]) terminalCommands[cmd].run(args, rawInput);
                else f.log(`COMMAND: ${cmd}`);
                e.target.value = '';
            }
        });
        f.syncThemeColors();
        f.applySettings();
        f.load();
    }

    function draw() {
        if(themeCatalog[themeIdx] && themeCatalog[themeIdx].className === 'theme-rainbow') {
            const styles = getComputedStyle(document.body);
            primaryColor = styles.getPropertyValue('--p').trim() || primaryColor;
        }
        ctx.fillStyle = corruptionLevel >= 2 ? "rgba(20,0,0,0.4)" : "rgba(1, 1, 3, 0.4)"; 
        ctx.fillRect(0,0,canvas.width,canvas.height);
        stars.forEach(s => {
            s.y += s.s * (warpActive ? 20 : 1); if(s.y > canvas.height) s.y = 0;
            ctx.fillStyle = warpActive ? primaryColor : (corruptionLevel >= 2 ? "#ff0000" : "#fff"); 
            ctx.fillRect(s.x, s.y, 1, warpActive ? 20 : 1);
        });
        requestAnimationFrame(draw);
    }

    // Auto-XP Loop
    setInterval(() => { if(aps > 0) { const b = (Date.now() < odEndTime) ? 3 : 1; xp += (aps/10)*b; f.checkLvl(); } }, 100);

    function update() {
        const now = Date.now(); 
        const realDiff = targetDate - now;
        const diff = isTestMode ? (realDiff - testTimeOffset) : realDiff;

        const stage = document.getElementById('main-stage');
        const status = document.getElementById('sys-status');
        stage.classList.remove('p-glitch-light', 'p-glitch-heavy', 'p-void-tear', 'p-zero-point', 'p-absolute-zero', 'p-panic');
        document.querySelectorAll('.info-item').forEach(el => el.classList.remove('info-active'));
        let panicLevel = 0;

        if(diff <= 0) {
            document.getElementById('final-screen').style.display = 'flex';
            stage.style.display = 'none';
        } else {
            document.getElementById('final-screen').style.display = 'none';
            stage.style.display = 'flex';

            if(diff <= 3600000 && diff > 60000) {
                corruptionLevel = 1;
                stage.classList.add('p-glitch-light');
                document.getElementById('info-26').classList.add('info-active');
                status.innerText = "V75.0 // SYSTEM: INSTABLE";
            } 
            else if(diff <= 60000) {
                corruptionLevel = 2;
                stage.classList.add('p-glitch-heavy');
                document.getElementById('info-heavy').classList.add('info-active');
                status.innerText = "V75.0 // SYSTEM: CRITICAL_FAILURE";
            } else {
                corruptionLevel = 0;
                status.innerText = "V75.0 // SYSTEM: STABLE";
            }

            if(diff <= 60000) panicLevel = 0.5;
            if(diff <= 30000) { stage.classList.add('p-void-tear'); panicLevel = 0.7; }
            if(diff <= 10000) { stage.classList.add('p-zero-point'); panicLevel = 0.9; }
            if(diff <= 2000) { stage.classList.add('p-absolute-zero'); panicLevel = 1; }
            if(panicLevel > 0) stage.classList.add('p-panic');
        }
        document.documentElement.style.setProperty('--panic', panicLevel);

        // UI Update
        document.getElementById('xp-display').innerText = Math.floor(xp).toLocaleString() + " XP";
        document.getElementById('lvl-tag').innerText = `LVL ${level}`;
        
        document.getElementById('d').innerText = String(Math.max(0, Math.floor(diff/86400000))).padStart(2,'0');
        document.getElementById('h').innerText = String(Math.max(0, Math.floor((diff/3600000)%24))).padStart(2,'0');
        document.getElementById('m').innerText = String(Math.max(0, Math.floor((diff/60000)%60))).padStart(2,'0');
        document.getElementById('s').innerText = String(Math.max(0, Math.floor(diff/1000)%60)).padStart(2,'0');

        const prog = Math.min(100, ((now - startDate) / (targetDate - startDate)) * 100);
        document.getElementById('p-fill').style.width = prog + "%";
    }

    window.onload = () => { init(); draw(); setInterval(update, 100); };
    window.onresize = () => { 
        canvas.width = window.innerWidth; 
        canvas.height = window.innerHeight; 
        f.buildStars();
    };
</script>
</body>
</html>
