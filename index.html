<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission 2026 - V75.0 Pure HTML</title>
    <link rel="stylesheet" href="./style.css?v=75">

</head>
<body id="body">

<canvas id="canvas"></canvas>
<div class="panic-overlay" aria-hidden="true"></div>
<div id="test-indicator">!! TEST MODUS AKTIV (ENTE) !!</div>

<div id="final-screen">
    <div style="font-size: 80px; margin-bottom: 20px; font-weight: 900;">0</div>
    <h1 style="letter-spacing: 15px; font-weight: 900;">MISSION 2026</h1>
    <p style="opacity: 0.6; font-size: 14px; margin-top: 10px;">SYSTEM ABSOLUTE ZERO ACHIEVED</p>
    <button class="reboot-btn" onclick="f.reboot()">SYSTEM REBOOT</button>
    <div style="margin-top: 60px; font-size: 12px; letter-spacing: 2px;">PROJEKT VON MIKRO 26</div>
    <div style="margin-top: 6px; font-size: 10px; letter-spacing: 2px; opacity: 0.6;">FROM MIKROLABS</div>
</div>

<div class="side-btns" id="ui-btns">
    <button class="btn" onclick="f.modal('shop')" title="Shop">ðŸ’Ž</button>
    <button class="btn" onclick="f.modal('themes')" title="Theme Vault">ðŸ§¬</button>
    <button class="btn" onclick="f.nextTheme()" title="Design">ðŸŽ¨</button>
    <button class="btn" id="boost-btn" onclick="f.boost()" title="Warp Drive">ðŸš€</button>
    <button class="btn" id="overdrive-btn" onclick="f.specialAction('overdrive')" title="Overdrive">
        âš¡<div id="od-timer-display" style="position:absolute; bottom:-18px; font-size:8px; font-weight:900; color:var(--p);"></div>
    </button>
</div>

<div class="stage" id="main-stage">
    <div class="xp-display-container" id="ui-xp" onclick="f.click(event)">
        <div id="lvl-tag" style="font-family:Orbitron; font-size:9px; background:var(--p); color:black; padding:2px 8px; border-radius:4px; font-weight:900; margin-bottom:5px; display:inline-block;">LVL 1</div>
        <div class="xp-val" id="xp-display">0 XP</div>
        <div id="xp-next" style="font-size:9px; opacity:0.6; font-family:Orbitron; margin-top:6px;">ZIEL: 500 XP</div>
    </div>

    <img src="https://image.jimcdn.com/app/cms/image/transf/none/path/s0265fddf63895aad/image/i230c837b21121d95/version/1766777777/image.png" 
         class="main-logo" id="main-logo" onclick="f.click(event)">

    <div class="countdown-grid" id="ui-timer">
        <div class="time-box"><span class="v" id="d">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">TAGE</span></div>
        <div class="time-box"><span class="v" id="h">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">STD</span></div>
        <div class="time-box"><span class="v" id="m">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">MIN</span></div>
        <div class="time-box"><span class="v" id="s">00</span><span style="font-size:8px; opacity:0.5; font-family:Orbitron;">SEK</span></div>
    </div>

    <div class="terminal-container" id="ui-term">
        <div id="terminal-content"></div>
        <div style="padding: 6px 12px; background: #08080a; display: flex; align-items: center; border-top: 1px solid rgba(255,255,255,0.05);">
            <span style="color:var(--p); font-family:'Fira Code'; font-size:11px; margin-right:8px;">></span>
            <input type="text" id="t-input" style="background:transparent; border:none; color:white; outline:none; font-family:'Fira Code'; font-size:11px; width:100%;" placeholder="Systemzugriff..." autocomplete="off">
        </div>
    </div>

    <div class="info-panel">
        <div style="margin-bottom: 5px; color: var(--p); border-bottom: 1px solid var(--p); padding-bottom: 2px;">CORRUPTION STATUS</div>
        <div class="info-grid">
            <div class="info-item" id="info-26"><span>STAGE 26 (INSTABLE)</span> <span>-1 Std</span></div>
            <div class="info-item" id="info-heavy"><span>STAGE 27 (CRITICAL)</span> <span>-60s</span></div>
            <div class="info-item" id="info-28"><span>STAGE 28 (COLLAPSE)</span> <span>-10s</span></div>
            <div class="info-item" id="info-30"><span>STAGE 30 (ZERO)</span> <span>-2.0s</span></div>
        </div>
    </div>
    
    <div style="font-size:8px; letter-spacing:4px; opacity:0.3; margin-top:8px; font-family:Orbitron;" id="sys-status">V75.0 // SYSTEM: STABLE</div>

    <div class="progress-bar-container">
        <div class="progress-fill" id="p-fill"></div>
    </div>
</div>

<div id="modal" onclick="if(event.target==this) f.modal()">
    <div class="modal-win" id="modal-content"></div>
</div>

<script>
    // System Variablen
    let testTimeOffset = 0;
    let isTestMode = false;
    let corruptionLevel = 0;
    let primaryColor = '#00f2ff';
    let secondaryColor = '#7000ff';

    const targetDate = new Date("January 1, 2026 00:00:00").getTime();
    const startDate = new Date("January 1, 2025 00:00:00").getTime();
    
    let canvas, ctx, stars = [];
    let xp = 0, level = 1, aps = 0, mult = 1, warpActive = false;
    let odEndTime = 0, themeIdx = 0;
    const baseThemes = [
        { name: 'DEFAULT', p: '', s: '', bg: '', bg2: '', className: '' },
        { name: 'GOLD', p: '#ffcc00', s: '#ff8800', bg: '', bg2: '' },
        { name: 'PINK', p: '#ff007a', s: '#7000ff', bg: '', bg2: '' },
        { name: 'GREEN', p: '#00ff88', s: '#0088ff', bg: '', bg2: '' },
        { name: 'MATRIX', p: '#00ff41', s: '#003b00', bg: '#000500', bg2: '#000500' },
        { name: 'CYBERPUNK', p: '#fcee0a', s: '#ff003c', bg: '#020205', bg2: '#020205' },
        { name: 'RAINBOW', p: '', s: '', bg: '', bg2: '', className: 'theme-rainbow' },
        { name: 'OCEAN', p: '#5de4ff', s: '#1b5bff', bg: '#031029', bg2: '#05062a' },
        { name: 'SUNSET', p: '#ffb347', s: '#ff416c', bg: '#2b0b1c', bg2: '#12060e' },
        { name: 'AURORA', p: '#7cffe6', s: '#8d7bff', bg: '#040714', bg2: '#0b1b2d' }
    ];
    const generatedThemes = Array.from({ length: 120 }, (_, i) => {
        const hue = Math.round((i * 360) / 120);
        const accent = (hue + 45) % 360;
        return {
            name: `SPECTRUM ${String(i + 1).padStart(3, '0')}`,
            p: `hsl(${hue} 90% 60%)`,
            s: `hsl(${accent} 90% 60%)`,
            bg: `hsl(${hue} 40% 8%)`,
            bg2: `hsl(${accent} 40% 10%)`
        };
    });
    const themeCatalog = [...baseThemes, ...generatedThemes];

    const items = [
        { id: 1, name: 'Neural Overclock', cost: 100, m: 3, a: 0, d: "Klick-Boost." },
        { id: 2, name: 'Quantum CPU', cost: 1200, m: 0, a: 80, d: "Auto-XP." },
        { id: 3, name: 'Void Harvester', cost: 15000, m: 50, a: 500, d: "Dunkle Energie." },
        { id: 4, name: 'Time Dilation', cost: 100000, m: 200, a: 2500, d: "Zeit-Streckung." },
        { id: 5, name: 'Prestige Protocol', cost: 800000, m: 1000, a: 15000, d: "System-Upgrade." }
    ];

    const f = {
        save: () => {
            const data = { 
                xp, level, aps, mult, themeIdx, odEndTime, 
                counts: items.map(i => i.count || 0),
                testTimeOffset, 
                isTestMode,
                corruptionLevel
            };
            localStorage.setItem('m26_v75_update', JSON.stringify(data));
        },
        load: () => {
            const s = localStorage.getItem('m26_v75_update');
            if(s) {
                const d = JSON.parse(s);
                xp = d.xp || 0; level = d.level || 1; aps = d.aps || 0; mult = d.mult || 1;
                themeIdx = Number.isInteger(d.themeIdx) ? d.themeIdx : 0; odEndTime = d.odEndTime || 0;
                if(themeIdx >= themeCatalog.length) themeIdx = 0;
                testTimeOffset = d.testTimeOffset || 0;
                isTestMode = d.isTestMode || false;
                corruptionLevel = d.corruptionLevel || 0;

                if(d.counts) d.counts.forEach((c, i) => items[i].count = c);
                f.applyTheme(themeIdx);
                if(isTestMode) document.getElementById('test-indicator').style.display = 'block';
            }
        },
        applyTheme: (idx) => {
            const theme = themeCatalog[idx] || themeCatalog[0];
            themeCatalog.forEach((t) => { if(t.className) document.body.classList.remove(t.className); });
            if(theme.className) document.body.classList.add(theme.className);
            const setVar = (key, value) => {
                if(value) document.documentElement.style.setProperty(key, value);
                else document.documentElement.style.removeProperty(key);
            };
            setVar('--p', theme.p);
            setVar('--s', theme.s);
            setVar('--bg', theme.bg);
            setVar('--bg2', theme.bg2);
            f.syncThemeColors();
        },
        setTheme: (idx) => {
            themeIdx = ((idx % themeCatalog.length) + themeCatalog.length) % themeCatalog.length;
            f.applyTheme(themeIdx);
            f.save();
        },
        syncThemeColors: () => {
            const styles = getComputedStyle(document.body);
            primaryColor = styles.getPropertyValue('--p').trim() || primaryColor;
            secondaryColor = styles.getPropertyValue('--s').trim() || secondaryColor;
            document.documentElement.style.setProperty('--glow', `${primaryColor}55`);
        },
        getXpNext: (l) => Math.floor(Math.pow(l, 2.4) * 500),
        getPrice: (i) => {
            let base = Math.floor(i.cost * Math.pow(1.6, i.count || 0));
            // Preisschwankungen bei Korruption
            if(corruptionLevel >= 1 && Math.random() < 0.1) return Math.floor(base * (Math.random() + 0.5));
            return base;
        },
        click: (e) => {
            let b = Date.now() < odEndTime ? 12 : 1;
            let g = (level * 5 + mult) * b;
            
            // Korruptionseffekte auf Gewinn
            if(corruptionLevel >= 1 && Math.random() < 0.05) g *= 0.1;
            if(corruptionLevel >= 2) g *= (Math.random() * 5);

            xp += g;
            if(e && e.clientX) {
                const el = document.createElement('div'); el.className = 'float-xp'; 
                el.innerText = `+${Math.floor(corruptionLevel >= 2 ? Math.random()*999 : g)}`; 
                el.style.left = e.clientX+'px'; el.style.top = e.clientY+'px';
                el.style.color = corruptionLevel >= 2 ? '#ff0000' : (b > 1 ? '#ffea00' : 'var(--p)');
                document.body.appendChild(el); setTimeout(() => el.remove(), 700);
            }
            f.checkLvl();
            f.save();
        },
        checkLvl: () => {
            let n = f.getXpNext(level);
            while(xp >= n) { xp -= n; level++; f.log(`LEVEL UP: ${level}`, true); n = f.getXpNext(level); }
        },
        modal: (t) => {
            if(t === 'shop' && corruptionLevel >= 1 && Math.random() < 0.2) {
                f.log("ERROR: SHOP_ACCESS_DENIED (CORE_LATENCY)");
                return;
            }
            const m = document.getElementById('modal'); const c = document.getElementById('modal-content');
            m.style.display = t ? 'flex' : 'none';
            if(t === 'shop') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:var(--p); text-align:center;">${corruptionLevel >= 2 ? 'C0RRUPT_SH0P' : 'QUANTUM SHOP'}</h2>`;
                items.forEach(i => {
                    const p = f.getPrice(i); const can = xp >= p;
                    c.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; margin:5px 0; background:rgba(255,255,255,0.03); border-radius:10px; border:1px solid ${can?'var(--p)':'#222'};">
                        <div style="font-size:10px;"><b>${corruptionLevel >= 2 ? '???' : i.name}</b> [v${i.count||0}]<br><small style="opacity:0.6">${i.d}</small></div>
                        <button onclick="if(${can}) f.buy(${i.id}, ${p})" ${can ? '' : 'disabled'} style="background:${can?'var(--p)':'#111'}; color:${can ? 'black' : '#666'}; font-family:Orbitron; font-size:9px; border:none; padding:8px 12px; border-radius:6px; cursor:${can ? 'pointer' : 'not-allowed'};">${p.toLocaleString()} XP</button>
                    </div>`;
                });
            } else if(t === 'themes') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:var(--p); text-align:center;">THEME VAULT</h2>
                <div style="font-size:9px; opacity:0.6; text-align:center;">${themeCatalog.length} THEMES // SETTHEME & THEMES COMMANDS</div>
                <div class="theme-vault">
                    ${themeCatalog.map((theme, idx) => {
                        const p = theme.p || '#00f2ff';
                        const s = theme.s || '#7000ff';
                        const bg = theme.bg || '#07070d';
                        const preview = theme.className === 'theme-rainbow'
                            ? 'linear-gradient(135deg, #ff0080, #00e5ff)'
                            : `linear-gradient(135deg, ${p}, ${s})`;
                        return `<button class="theme-card" onclick="f.setTheme(${idx}); f.modal();" title="SET ${theme.name}">
                            <div class="theme-preview" style="background:${preview}; border:1px solid ${bg};"></div>
                            ${theme.name}
                            <span>#${String(idx).padStart(3,'0')}</span>
                        </button>`;
                    }).join('')}
                </div>`;
            } else if(t === 'test') {
                c.innerHTML = `<h2 style="font-family:Orbitron; color:#ff0055; text-align:center;">ENTE PROTOKOLL</h2>
                <input type="number" id="test-seconds-input" class="test-input-field" placeholder="Sekunden bis Ziel">
                <button class="btn" style="width:100%; margin-bottom:10px;" onclick="f.setTestTime(document.getElementById('test-seconds-input').value)">START</button>
                <button class="btn" style="width:100%;" onclick="f.modal()">CANCEL</button>`;
            }
        },
        setTestTime: (val) => {
            const seconds = parseInt(val);
            if(isNaN(seconds)) { 
                testTimeOffset = 0; 
                isTestMode = false; 
                document.getElementById('test-indicator').style.display='none'; 
            } else { 
                testTimeOffset = targetDate - Date.now() - (seconds * 1000); 
                isTestMode = true; 
                document.getElementById('test-indicator').style.display='block'; 
            }
            f.modal();
            f.save();
        },
        reboot: () => {
            testTimeOffset = 0;
            isTestMode = false;
            corruptionLevel = 0;
            localStorage.removeItem('m26_v75_update');
            location.reload();
        },
        buy: (id, p) => {
            const i = items.find(x => x.id === id);
            if(xp >= p) { 
                xp -= p; 
                i.count = (i.count || 0) + 1; 
                aps += i.a; 
                mult += i.m; 
                f.modal('shop'); 
                f.save(); 
            }
        },
        log: (m, imp = false) => {
            const t = document.getElementById('terminal-content'); const d = document.createElement('div');
            if(corruptionLevel >= 1 && Math.random() < 0.3) m = m.replace(/[A-E]/g, '0').replace(/[S-Z]/g, '#');
            if(imp) d.style.color = 'var(--p)'; d.innerHTML = `<span>[SYS]</span> ${m}`;
            t.prepend(d); if(t.childNodes.length > 20) t.lastChild.remove();
        },
        nextTheme: () => {
            f.setTheme(themeIdx + 1);
        },
        boost: () => { warpActive = !warpActive; document.getElementById('boost-btn').style.background = warpActive ? 'var(--p)' : ''; },
        specialAction: (t) => {
            if(t === 'overdrive') {
                const cost = Math.floor(f.getXpNext(level) * 0.3);
                if(xp >= cost && Date.now() > odEndTime) { 
                    xp -= cost; 
                    odEndTime = Date.now() + 120000; 
                    f.log("OVERDRIVE AKTIVIERT"); 
                    f.save(); 
                }
            }
        }
    };

    const getCountdownDiff = () => {
        const now = Date.now();
        const realDiff = targetDate - now;
        return isTestMode ? (realDiff - testTimeOffset) : realDiff;
    };

    const formatCountdown = (diff) => {
        const safe = Math.max(0, diff);
        const d = Math.floor(safe / 86400000);
        const h = Math.floor((safe / 3600000) % 24);
        const m = Math.floor((safe / 60000) % 60);
        const s = Math.floor((safe / 1000) % 60);
        return `${String(d).padStart(2,'0')}d ${String(h).padStart(2,'0')}h ${String(m).padStart(2,'0')}m ${String(s).padStart(2,'0')}s`;
    };

    const getThemeLabel = () => themeCatalog[themeIdx] ? themeCatalog[themeIdx].name : 'DEFAULT';

    const terminalHelpLines = [
        "CORE: HELP, COMMANDS, STATUS, VERSION, TIME, DATE, UPTIME, SYSINFO, PROTOCOL",
        "STATS: XP, LEVEL, APS, MULT, CORRUPTION, PANIC, COUNTDOWN, PROGRESS, STARS",
        "ACTIONS: THEME, NEXTTHEME, THEMEIDX, THEMES, SETTHEME, VAULT, WARP, BOOST, OVERDRIVE, SHOP, TEST",
        "TOOLS: SAVE, LOAD, CLEAR, PING, ECHO, TRACE, SCAN, DIAG, CORE, MAP, LOGS, CALIBRATE, ALIGN, SAFEMODE, REBOOT"
    ];

    const terminalCommands = {
        HELP: { run: () => terminalHelpLines.slice().reverse().forEach(line => f.log(line)) },
        COMMANDS: { run: () => terminalCommands.HELP.run() },
        STATUS: { run: () => f.log(`STATUS: ${document.getElementById('sys-status').innerText}`) },
        VERSION: { run: () => f.log("VERSION: V75.0") },
        TIME: { run: () => f.log(`TIME: ${new Date().toLocaleTimeString('de-DE')}`) },
        DATE: { run: () => f.log(`DATE: ${new Date().toLocaleDateString('de-DE')}`) },
        UPTIME: { run: () => f.log(`UPTIME: ${Math.floor(performance.now() / 1000)}s`) },
        XP: { run: () => f.log(`XP: ${Math.floor(xp).toLocaleString()} / NEXT: ${f.getXpNext(level).toLocaleString()}`) },
        LEVEL: { run: () => f.log(`LEVEL: ${level}`) },
        APS: { run: () => f.log(`APS: ${aps}`) },
        MULT: { run: () => f.log(`MULTI: x${mult}`) },
        WARP: { run: () => { f.boost(); f.log(`WARP: ${warpActive ? 'ON' : 'OFF'}`); } },
        BOOST: { run: () => terminalCommands.WARP.run() },
        OVERDRIVE: { run: () => {
            const cost = Math.floor(f.getXpNext(level) * 0.3);
            if(Date.now() <= odEndTime) { f.log("OVERDRIVE: COOLDOWN"); return; }
            if(xp < cost) { f.log(`OVERDRIVE: NEED ${cost.toLocaleString()} XP`); return; }
            f.specialAction('overdrive');
        }},
        THEME: { run: () => f.log(`THEME: ${getThemeLabel()}`) },
        NEXTTHEME: { run: () => { f.nextTheme(); f.log(`THEME SET: ${getThemeLabel()}`); } },
        THEMEIDX: { run: () => f.log(`THEME IDX: ${themeIdx}`) },
        THEMES: { run: () => f.log(`THEMES: ${themeCatalog.length} TOTAL. USE SETTHEME <IDX> OR VAULT`) },
        SETTHEME: { run: (args) => {
            const idx = parseInt(args, 10);
            if(Number.isNaN(idx)) { f.log("SETTHEME: NEED INDEX"); return; }
            if(idx < 0 || idx >= themeCatalog.length) { f.log(`SETTHEME: OUT OF RANGE (0-${themeCatalog.length - 1})`); return; }
            f.setTheme(idx);
            f.log(`THEME SET: ${getThemeLabel()}`);
        }},
        VAULT: { run: () => { f.modal('themes'); f.log("VAULT: OPEN"); } },
        SHOP: { run: () => { f.modal('shop'); f.log("SHOP: OPEN"); } },
        TEST: { run: () => { f.modal('test'); f.log("TEST MODE: PANEL"); } },
        REBOOT: { run: () => f.reboot() },
        SAVE: { run: () => { f.save(); f.log("SAVE: OK"); } },
        LOAD: { run: () => { f.load(); f.log("LOAD: OK"); } },
        CLEAR: { run: () => { document.getElementById('terminal-content').innerHTML = ''; f.log("TERMINAL CLEARED"); } },
        PING: { run: () => f.log("PONG") },
        ECHO: { run: (args) => f.log(args ? `ECHO: ${args}` : "ECHO: ...") },
        TRACE: { run: () => f.log("TRACE: ROUTE_STABLE") },
        SCAN: { run: () => f.log("SCAN: NO ANOMALIES") },
        DIAG: { run: () => f.log("DIAG: ALL SYSTEMS GREEN") },
        SYSINFO: { run: () => f.log("SYSINFO: QUANTUM CORE ONLINE") },
        CORE: { run: () => f.log("CORE: SYNCHRONIZED") },
        MAP: { run: () => f.log("MAP: SECTOR-07 LOCKED") },
        LOGS: { run: () => f.log("LOGS: 0 ERRORS") },
        PROTOCOL: { run: () => f.log("PROTOCOL: ORBITRON-74") },
        SAFEMODE: { run: () => f.log("SAFE MODE: DISABLED") },
        CALIBRATE: { run: () => f.log("CALIBRATE: COMPLETE") },
        ALIGN: { run: () => f.log("ALIGN: STABLE") },
        STARS: { run: () => f.log(`STARS: ${stars.length}`) },
        CORRUPTION: { run: () => f.log(`CORRUPTION: STAGE ${corruptionLevel}`) },
        PANIC: { run: () => f.log(`PANIC: ${getComputedStyle(document.documentElement).getPropertyValue('--panic').trim()}`) },
        COUNTDOWN: { run: () => f.log(`COUNTDOWN: ${formatCountdown(getCountdownDiff())}`) },
        PROGRESS: { run: () => {
            const prog = Math.min(100, ((Date.now() - startDate) / (targetDate - startDate)) * 100);
            f.log(`PROGRESS: ${prog.toFixed(2)}%`);
        }}
    };

    function init() {
        canvas = document.getElementById('canvas'); ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        for(let i=0; i<80; i++) stars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*1.5+0.2});
        
        document.getElementById('t-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') {
                const rawInput = e.target.value.trim();
                if(!rawInput) return;
                const [first] = rawInput.split(/\s+/);
                const cmd = first.toUpperCase();
                const args = rawInput.slice(first.length).trim();
                if(corruptionLevel >= 1 && Math.random() < 0.15) { f.log(`CRITICAL: CMD_${cmd}_TIMED_OUT`); e.target.value = ''; return; }
                if(cmd === 'ENTE') f.modal('test');
                else if(terminalCommands[cmd]) terminalCommands[cmd].run(args, rawInput);
                else f.log(`COMMAND: ${cmd}`);
                e.target.value = '';
            }
        });
        f.syncThemeColors();
        f.load();
    }

    function draw() {
        if(themeCatalog[themeIdx] && themeCatalog[themeIdx].className === 'theme-rainbow') {
            const styles = getComputedStyle(document.body);
            primaryColor = styles.getPropertyValue('--p').trim() || primaryColor;
        }
        ctx.fillStyle = corruptionLevel >= 2 ? "rgba(20,0,0,0.4)" : "rgba(1, 1, 3, 0.4)"; 
        ctx.fillRect(0,0,canvas.width,canvas.height);
        stars.forEach(s => {
            s.y += s.s * (warpActive ? 20 : 1); if(s.y > canvas.height) s.y = 0;
            ctx.fillStyle = warpActive ? primaryColor : (corruptionLevel >= 2 ? "#ff0000" : "#fff"); 
            ctx.fillRect(s.x, s.y, 1, warpActive ? 20 : 1);
        });
        requestAnimationFrame(draw);
    }

    // Auto-XP Loop
    setInterval(() => { if(aps > 0) { const b = (Date.now() < odEndTime) ? 3 : 1; xp += (aps/10)*b; f.checkLvl(); } }, 100);

    function update() {
        const now = Date.now(); 
        const realDiff = targetDate - now;
        const diff = isTestMode ? (realDiff - testTimeOffset) : realDiff;

        const stage = document.getElementById('main-stage');
        const status = document.getElementById('sys-status');
        stage.classList.remove('p-glitch-light', 'p-glitch-heavy', 'p-void-tear', 'p-zero-point', 'p-absolute-zero', 'p-panic');
        document.querySelectorAll('.info-item').forEach(el => el.classList.remove('info-active'));
        let panicLevel = 0;

        if(diff <= 0) {
            document.getElementById('final-screen').style.display = 'flex';
            stage.style.display = 'none';
        } else {
            document.getElementById('final-screen').style.display = 'none';
            stage.style.display = 'flex';

            if(diff <= 3600000 && diff > 60000) {
                corruptionLevel = 1;
                stage.classList.add('p-glitch-light');
                document.getElementById('info-26').classList.add('info-active');
                status.innerText = "V75.0 // SYSTEM: INSTABLE";
            } 
            else if(diff <= 60000) {
                corruptionLevel = 2;
                stage.classList.add('p-glitch-heavy');
                document.getElementById('info-heavy').classList.add('info-active');
                status.innerText = "V75.0 // SYSTEM: CRITICAL_FAILURE";
            } else {
                corruptionLevel = 0;
                status.innerText = "V75.0 // SYSTEM: STABLE";
            }

            if(diff <= 60000) panicLevel = 0.5;
            if(diff <= 30000) { stage.classList.add('p-void-tear'); panicLevel = 0.7; }
            if(diff <= 10000) { stage.classList.add('p-zero-point'); panicLevel = 0.9; }
            if(diff <= 2000) { stage.classList.add('p-absolute-zero'); panicLevel = 1; }
            if(panicLevel > 0) stage.classList.add('p-panic');
        }
        document.documentElement.style.setProperty('--panic', panicLevel);

        // UI Update
        document.getElementById('xp-display').innerText = Math.floor(xp).toLocaleString() + " XP";
        document.getElementById('lvl-tag').innerText = `LVL ${level}`;
        
        document.getElementById('d').innerText = String(Math.max(0, Math.floor(diff/86400000))).padStart(2,'0');
        document.getElementById('h').innerText = String(Math.max(0, Math.floor((diff/3600000)%24))).padStart(2,'0');
        document.getElementById('m').innerText = String(Math.max(0, Math.floor((diff/60000)%60))).padStart(2,'0');
        document.getElementById('s').innerText = String(Math.max(0, Math.floor(diff/1000)%60)).padStart(2,'0');

        const prog = Math.min(100, ((now - startDate) / (targetDate - startDate)) * 100);
        document.getElementById('p-fill').style.width = prog + "%";
    }

    window.onload = () => { init(); draw(); setInterval(update, 100); setInterval(f.save, 5000); };
    window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
</script>
</body>
</html>
